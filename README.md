# üß† LangFLow Finance RAG Chatbot - Langflow

This project provides a Langflow-compatible Retrieval-Augmented Generation (RAG) chatbot focused on financial analysis using structured data, including reports from the Pakistan Stock Exchange (PSX). The chatbot uses keyword extraction, semantic search (via AstraDB), parsing, prompt templating, and LLM response generation.

## üìÇ Files Included

- `Finance RAG.json`: Pre-built Langflow flow ready to be imported.
- Custom Components:
  - Keyword Extractor (extracts keywords and original question)
  - Prompt template for financial reasoning
- Integration with:
  - AstraDB vector search
  - OpenAI (or compatible) LLM
  - Langflow components: ChatInput, Parser, Prompt, ChatOutput, etc.

---

## üîß Prerequisites

Make sure you have the following installed:

### 1. Python Environment
```bash
python >= 3.10
```

### 2. Create and activate a virtual environment (optional but recommended)
```bash
python -m venv .venv
source .venv/bin/activate   # On Windows: .venv\Scripts\activate
```

### 3. Langflow Installation
```bash
pip install langflow
```

Alternatively, if you want to install from source:
```bash
git clone https://github.com/langflow-ai/langflow.git
cd langflow
pip install -e .
```

### 4. Additional Dependencies
Make sure the following are installed as needed:
```bash
pip install cassio  # Required for AstraDB integration
pip install langchain-openai  # To support OpenAI model in Langflow
```

### 5. AstraDB Setup
- Create a free [AstraDB](https://www.datastax.com/astra) instance.
- Obtain the **Database ID**, **Region**, **Keyspace**, and **Application Token**.
- Set environment variables or configure in Langflow directly.

### 6. OpenAI API Key
Export your API key:
```bash
export OPENAI_API_KEY="your-key-here"  # Linux/macOS
set OPENAI_API_KEY="your-key-here"     # Windows
```

---

## üöÄ Getting Started

### 1. Run Langflow
```bash
langflow run
```

### 2. Import the Flow
- Navigate to the Langflow web interface (usually at `http://localhost:7860`)
- Click on `Import Flow` and upload the file `Finance RAG.json`

### 3. Add Secrets and API Keys
- Configure `OpenAI` components with your API Key.
- Configure `AstraDB` with your credentials:
  - DB ID
  - DB Region
  - Keyspace
  - Token
- You can do this by clicking each node and updating the right-side settings panel.

---

## üß† Flow Overview

This Langflow RAG pipeline does the following:

1. **User input** is taken via `ChatInput`
2. **LLM parses** the input and passes it to a **custom component** that extracts:
   - Keywords (e.g., companies, years, sectors)
   - User‚Äôs original question
3. **AstraDB** is queried using the extracted keywords
4. Retrieved documents are **parsed and formatted**
5. The **prompt** is dynamically filled with the parsed context and user question
6. Final response is generated by **OpenAI model**
7. Response is shown using `ChatOutput`

---

## üìå Notes

- Ensure that the documents indexed in AstraDB are embedded using the same embedding model used by Langflow‚Äôs vector store.
- You can modify or extend the `Prompt`, `Parser`, or even the `CustomComponent` logic for advanced use cases.
- The `CustomComponent` supports extraction from structured JSON containing both the keywords and the question.

---

## üÜò Troubleshooting

- **Import errors**: Make sure your `langflow` version matches the export file (v1.4.2 as used here).
- **AstraDB issues**: Ensure you‚Äôve uploaded data using embeddings compatible with your search queries.
- **OpenAI errors**: Check token limits, rate limits, and the temperature settings if outputs are too random or too deterministic.

---

## ü§ù Contribution

This project can be extended to support:
- Multi-lingual queries
- Support for other vector databases like Pinecone, Weaviate, etc.
- Integration with document crawlers (like Firecrawl or Browserless)

---

